!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("yawp.fixtures",[],t):"object"==typeof exports?exports["yawp.fixtures"]=t():e["yawp.fixtures"]=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),u=i(r),o=n(3)(u["default"]);yawp&&(yawp.fixtures=o),t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function i(e,t,n,i){4===e.readyState&&(200===e.status?n(t.json?JSON.parse(e.responseText):e.responseText):i(e))}function r(e,t){t&&"omit"!==t&&(e.withCredentials=!0)}function u(e,t){t=t||{},(0,o.extend)(t,{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"});for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n])}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){return new Promise(function(n,a){var s=t.query;delete t.query;var f=new XMLHttpRequest;f.onreadystatechange=function(){i(f,t,n,a)},f.open(t.method,e+(s?"?"+(0,o.toUrlParam)(s):"")),u(f,t.headers),r(f,t.credentials),f.send(t.body)})};var o=n(2);e.exports=t["default"]},function(e,t){"use strict";function n(){for(var e=arguments[0]||{},t=1,n=arguments.length;t<n;t++){var i=arguments[t];for(var r in i)e[r]=i[r]}return e}function i(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}Object.defineProperty(t,"__esModule",{value:!0}),t.extend=n,t.toUrlParam=i},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(2),a="/fixtures",s="/_ah/yawp/datastore/delete-all",f=["id"];t["default"]=function(e){var t=function(){function t(){i(this,t),this._baseUrl=a,this._resetUrl=s,this._lazyProperties=f,this.promise=null,this.fixtures=[],this.lazy={}}return u(t,[{key:"config",value:function(e){e(this)}},{key:"baseUrl",value:function(e){this._baseUrl=e}},{key:"resetUrl",value:function(e){this._resetUrl=e}},{key:"lazyProperties",value:function(e){this._lazyProperties=e}},{key:"reset",value:function(t){var n=this;return e(this._resetUrl,{method:"GET"}).then(function(){n.clear(t)})}},{key:"clear",value:function(e){this.promise=null;for(var t=0,n=this.fixtures.length;t<n;t++){var i=this.fixtures[t].name,r=this.fixtures[t].path;this.bindFixture(i,r),e&&this.bindLazy(i,r)}}},{key:"bind",value:function(e,t){this.fixtures.push({name:e,path:t}),this.bindFixture(e,t),this.bindLazy(e)}},{key:"bindFixture",value:function(e,t){this[e]=new n(this,e,t).api}},{key:"bindLazy",value:function(e){this.lazy[e]=new c(this,e).api}},{key:"chain",value:function(e){return this.promise?this.promise=this.promise.then(e):this.promise=e(),this.promise}},{key:"load",value:function(e){return this.promise?this.promise.then(function(){return e&&e()}):new Promise(function(){return e&&e()})}}]),t}(),n=function(){function t(e,n,r){i(this,t),this.fx=e,this.name=n,this.path=r,this.api=this.createApi()}return u(t,[{key:"createApi",value:function(){var e=this,t=function(t,n){return e.fx.chain(e.load(t,n))};return t.self=this,t}},{key:"url",value:function(){return this.fx._baseUrl+this.path}},{key:"load",value:function(e,t){return this.createStubs(e),this.createLoadPromiseFn(e,t)}},{key:"createLoadPromiseFn",value:function(t,n){var i=this;return n||(n=this.getLazyDataFor(t)),function(){return i.isLoaded(t)?i.api[t]:i.prepare(n).then(function(n){return e(i.url(),{method:"POST",json:!0,body:JSON.stringify(n)}).then(function(e){return i.api[t]=e,e})})}}},{key:"getLazyDataFor",value:function(e){var t=this.fx.lazy[this.name].self;return t.getData(e)}},{key:"prepare",value:function(e){var t=this;return new Promise(function(n){var i={};(0,o.extend)(i,e);var r=[];t.inspectLazyProperties(i,r),t.resolveLazyProperties(i,r,n)})}},{key:"resolveLazyProperties",value:function(e,t,n){if(t.length){for(var i=t[0](),r=1,u=t.length;r<u;r++)i=i.then(t[r]);i.then(function(){n(e)})}else n(e)}},{key:"inspectLazyProperties",value:function(e,t){var n=this,i=function(i){if(!e.hasOwnProperty(i))return"continue";var r=e[i];return r instanceof Function?(t.push(function(){return r().then(function(t){e[i]=t})}),"continue"):r instanceof Object?(n.inspectLazyProperties(r,t),{v:void 0}):void 0};for(var u in e){var o=i(u);switch(o){case"continue":continue;default:if("object"===("undefined"==typeof o?"undefined":r(o)))return o.v}}}},{key:"createStubs",value:function(e){if(!this.hasStubs(e)){var t=this;this.api[e]=this.fx._lazyProperties.reduce(function(n,i){return n[i]=function(){return new Promise(function(n){return n(t.api[e][i])})},n},{}),this.api[e].__stub__=!0}}},{key:"isLoaded",value:function(e){return this.api[e]&&!this.hasStubs(e)}},{key:"hasStubs",value:function(e){return this.api[e]&&this.api[e].__stub__}}]),t}(),c=function(){function e(t,n){i(this,e),this.fx=t,this.name=n,this.data={},this.api=this.createApi()}return u(e,[{key:"createApi",value:function(){var e=this,t=function(t,n){e.createLazyStubs(t),e.data[t]=n};return t.self=this,t}},{key:"getData",value:function(e){return this.data[e]}},{key:"createLazyStubs",value:function(e){var t=this;this.hasStubs(e)||(this.api[e]=this.fx._lazyProperties.reduce(function(n,i){return n[i]=function(){return t.getFixtureRef().load(e)().then(function(e){return e[i]})},n},{}),this.api[e].__stub__=!0)}},{key:"hasStubs",value:function(e){return this.api[e]&&this.api[e].__stub__}},{key:"getFixtureRef",value:function(){return this.fx[this.name].self}}]),e}();return new t},e.exports=t["default"]}])});
//# sourceMappingURL=yawp.fixtures.min.js.map